# CoaCor: Code Annotation for Code Retrieval with Reinforcement Learning

## 1. Introduction
This repository contains source code and dataset for paper "CoaCor: Code Annotation for Code Retrieval with Reinforcement Learning" (To appear at WWW'19), which explores how to generate rich code annotations (CA) that can be useful to code retrieval (CR) task. 

![Framework Image](doc/figure/framework2_camera.png)
- **Training phase**. A code annotation model is trained via reinforcement learning to maximize retrieval-based rewards given by a QC-based code retrieval model.
- **Testing phase**. Each code snippet is first annotated by the trained CA model. For the code retrieval task, given query Q, acode snippet gets two scores - one matching Q with its code content and the other matching Q with its code annotation N,and is ranked by a simple ensemble strategy. 
- **Example**. We show an example of a code snippet and its associated multiple NL queries in our dataset. The code annotation generated by our framework is much more detailed with many keywords semantically aligned with Qs, when compared with CA models trained via MLE or RL with BLEU rewards.

For more details, please refer to our paper.

### Generation Outputs
Outputs of each CA model, i.e., CodeNN, MLE-based, RL-BLEU and RL_MRR (ours), can be found under folder [final_generations](final_generations/).

## 2. Dataset
### Source Data
- StaQC data: provided by [Yao et al., WWW'18](https://github.com/LittleYUYU/StackOverflow-Question-Code-Dataset). 
- DEV/EVAL set: provided by [Iyer et al., ACL'16](https://github.com/sriniiyer/codenn).
- Other source data (e.g., train/validation/test set splits, vocabulary) can be found [here](data/source).

### Processed Data
The processed data for CA or CR are under their own folder.
- For Code Annotations: please decompress the `train_need_decompress.tar` file [here](code/code_annotation/dataset/train_qt_new_cleaned/).
- For Code Retrieval: all data can be found [here](code/CodeRetrieval-Main/data/).

## 3. Code
### Requirements

### Run the model

## 4. Citation
Please kindly cite the following paper if you use the code or the dataset in this repo:
To be added.
